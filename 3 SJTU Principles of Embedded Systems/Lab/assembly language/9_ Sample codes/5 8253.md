## 8253 
1. 具有三个独立的16位计数器
2. 每个计数器可以按照二进制或者BCD码计数
3. 每个计数器有六种工作方式
4. 全部I/O与TTL电平兼容
5. 减法计数器,每来一个计数脉冲就减1，减到0的时产生一个定时信号输出。

    A1A0: 
    00: 选中0
    01: 选中1
    10: 选中2
    11: 选中控制字(写的时候)
    
## 1. 8253的管脚
1. D7~D0: 计数初值输入
2. CLK_i: 计数器的时钟输入端
3. OUT_i: 计数器的输出信号
4. GATE_i: 门控信号，启动或者禁止计数器的减一操作

## 2. 8253的计数器
每个计数器都包括一个16位的初值寄存器、一个计数执行单元和一个输出锁存器

1. 当置入初值后，计数执行单元开始对CLK进行减1计数，减到0的时候从OUT端输出一个信号
2. 整个过程可以重复进行
3. 可以按照二进制计数也可以按照十进制计数
4. 计数过程中，计数器还受到门控信号GATE的控制
5. 在不同的工作方式下，计数器的输入CLK、输出OUT、门控信号GATE之间的关系将会不同

## 3. 8253的控制寄存器
1. 存放操作控制字
2. 通过向控制寄存器中写入不同的控制字决定计数器的工作方式
3. 控制字在8253初始化的时候写入，只能写，不能读

## 4. 8253的计数方式
1. 不重复的技术方式: 计数器每启动一次只工作一个周期
2. 自动重复的计数方式: 一旦计数启动，只要门控信号GATE保持高电平，计数过程就会自动周而复始地重复下去，此时OUT端将会产生连续地波形
3. 在自动重复计数地方式下，稳定状态后，启动时造成地实际计数值和计数初值之间地误差不再存在

## 5. 8253的初始化
1. 写入方式控制字: 三个通道的控制字端口相同，写入后存在对应的寄存器中
2. 写入计数初值
3. 读计数值(计时)
    
        假设: 要用8253的0计数器作为十进制计数器，输入100KHz的CLK，输出1KHz的方波
        #0: 210H #1:211H #2:212H 控制端:213H
        计数值应该为100
        控制字应该为 00 11 011 1B
        MOV AL, 37H
        MOV DX, 213H
        OUT DX, AL
        MOV DX, 210H
        MOV AL, 00H
        OUT DX, AL
        MOV AL, 01h ;   按BCD码计数！
        OUT DX, AL
        
        假设: 8253端口地址3F0H~3F3H,要求通道0工作在方式3，计数初值为1234
        MOV AL, 00110111B
        MOV DX, 3F3H
        OUT DX, AL
        MOV DX, 3F0H
        MOV AL, 34H
        OUT DX, AL
        MOV AL, 12H
        OUT DX, AL
        
        MOV AL, 00000111B
        MOV DX, 3F3H
        OUT DX, AL
        MOV DX, 3F0H
        IN AL, DX   ; 读低字节
        MOV AH, AL
        IN AL, DX   ; 读高字节
        XCHG AH, AL
        MOV CX, 1234+1
        SUB CX, AX
  
        例如: 3个计数器CLK均为2M,要求计数器0在100us后中断请求，计数器1产生10us对称方波，计数器2每1ms产生一个负脉冲
        1/2M * f = T
        INIT8253:
        MOV DX, 0FF07H
        MOV AL, 10H ;   计数器0,只写低八位，方式0，二进制计数
        OUT DX, AL
        MOV AL, 56H ;   计数器1,只写低八位，方式3，二进制计数
        OUT DX, AL
        MOV AL, 0B4H;   计数器2，先写高8位后写低8位，方式2，二进制计数
        OUT DX, AL
        MOV DX, 0FF04H
        MOV AL, 200
        OUT DX, AL
        MOV DX, 0FF05H
        MOV AL, 20
        OUT DX, AL
        MOV DX, 0FF06H
        MOV AX, 2000
        OUT DX, AL
        MOV AL, AH
        OUT DX, AL
